<analysis>**original_problem_statement:**
O usuário está desenvolvendo um **SIGESC (Sistema Integrado de Gestão Escolar)**, um projeto full-stack (React/FastAPI/MongoDB). O desenvolvimento está dividido em fases. O sistema deve suportar múltiplos perfis (Administrador, Secretário, SEMED, etc.) com diferentes permissões.

**PRODUCT REQUIREMENTS:**
- **Sistema:** Multi-escola, multi-perfil (RBAC).
- **Tecnologia:** Frontend React (com shadcn/ui), Backend FastAPI, Banco de Dados MongoDB.
- **Funcionalidades Principais:**
    - Gestão de Escolas, Usuários, Turmas, Componentes Curriculares, Alunos.
    - O perfil  deve ter acesso de visualização total, mas sem permissões de edição ou exclusão.
    - Cadastro de Alunos deve ser um formulário complexo com múltiplas abas.
    - Importação em massa de alunos a partir de um arquivo Excel.
    - Lançamento de notas com cálculo de média ponderada.
    - Geração de documentos (Boletins, Declarações).
    - **[CONCLUÍDO]** Um Calendário Letivo com visualizações anuais, mensais, semanais e diárias, e gerenciamento de eventos (feriados, dias letivos/não letivos).
    - **[EM ANDAMENTO]** Fase 5: Controle de Frequência.

**User's preferred language**: Portuguese (Português)

**what currently exists?**
Uma aplicação full-stack funcional com autenticação JWT e RBAC. O sistema possui módulos robustos para gestão de Escolas, Usuários, Alunos, Turmas e Componentes Curriculares. A Fase 4 (Sistema de Notas) foi concluída, incluindo um sistema de recuperação semestral (Rec. 1º e 2º Sem.) e cálculo de média que considera campos vazios como zero. Recentemente, a funcionalidade de Calendário Letivo foi implementada com sucesso, permitindo o gerenciamento de eventos e a visualização em múltiplos formatos (anual, mensal, etc.). A estrutura inicial para a Fase 5 (Controle de Frequência) foi criada.

**Last working item**:
- **Last item agent was working:** O agente iniciou a implementação da **Fase 5 - Controle de Frequência**. Com base nos requisitos detalhados do usuário, foram criados os arquivos e estruturas iniciais para a nova funcionalidade.
    - **Reasoning:** Esta é a próxima fase do projeto, conforme solicitado pelo usuário após a conclusão bem-sucedida do Calendário Letivo. O agente preparou o terreno para o desenvolvimento, criando os modelos de dados, endpoints de API e a página do frontend.
- **Status:** IN PROGRESS
- **Agent Testing Done:** N
- **Which testing method agent to use?** both
- **User Testing Done:** N

**All Pending/In progress Issue list**:
Nenhum problema pendente.

**In progress Task List**:
- **Task 1: Concluir a implementação da Fase 5 - Controle de Frequência (P0)**
    - **Where to resume:** A estrutura base está pronta. O próximo passo é desenvolver a interface do usuário em  e implementar a lógica de negócios nos endpoints da API em . É preciso implementar as regras específicas de frequência (diária vs. por componente curricular) baseadas no nível de ensino da turma, o cálculo de 75% de presença e as permissões para administradores/secretários.
    - **What will be achieved with this?** Um sistema completo para registro e consulta de frequência de alunos, conforme os requisitos do usuário.
    - **Status:** IN PROGRESS
    - **Should Test frontend/backend/both after fix?** both
    - **Blocked on something:** None

**Upcoming and Future Tasks**
- **Upcoming Tasks:**
    - **P0: Testar a Fase 5 - Controle de Frequência:** Após a implementação, realizar testes completos no fluxo de lançamento, consulta e validação de frequência.
- **Future Tasks:**
    - **P1: FASE 6 - Portais de Visualização:** Dashboards específicos para os perfis de Aluno, Responsável e Diretor.
    - **P2: FASE 7 - Sistema de Comunicação:** CRUD de Avisos.
    - **P3: FASE 8 - Geração de Documentos:** Funcionalidade para gerar PDFs (Boletim, Declarações).

**Completed work in this session**
- **Finalização da Fase 4 - Sistema de Notas:**
    - Implementado um sistema de recuperação duplo (1º e 2º semestre), atualizando o modelo de dados ( em ), a lógica de cálculo () e a interface do usuário ().
    - Ajustada a lógica de cálculo da média para ser exibida desde a primeira nota lançada, tratando campos vazios como zero.
    - Corrigido um bug de validação no backend que impedia a listagem de componentes curriculares legados (tornando  e  opcionais no modelo ).
    - Realizados testes completos de frontend e backend para validar todo o fluxo de notas.
- **Implementação do Calendário Letivo (Nova Fase):**
    - Criados modelos (), endpoints de API e páginas de frontend (, ) para a funcionalidade.
    - Populado o calendário de 2026 com feriados nacionais e períodos letivos, conforme solicitado.
    - Corrigido um bug de autenticação nos endpoints da API do calendário.
    - Resolvido um problema de banco de dados onde um script de seeding estava se conectando a uma instância de DB diferente da aplicação principal.
    - Ajustada a exibição da visualização semanal para começar no domingo e terminar no sábado.
    - Adicionado um botão Voltar ao Dashboard nas páginas do calendário.
    - Removidas as etiquetas redundantes Sábado e Domingo de dentro das células do calendário.
- **Início da Fase 5 - Controle de Frequência:**
    - Criados os modelos de dados () e os endpoints de API para frequência.
    - Criada a página de frontend () e as rotas necessárias.

**Earlier issues found/mentioned but not fixed**
- **Issue 1:** O arquivo  está com mais de 1500 linhas. Ele deve ser quebrado em componentes menores para melhorar a manutenibilidade.
    - **Debug checklist:** Propor ao usuário um refatoramento após a conclusão das fases atuais.
    - **Why to solve this issue and what will be achieved with this?** Melhorar a organização e facilitar futuras manutenções no código mais complexo da aplicação.
    - **Should Test frontend/backend/both after fix:** frontend
    - **Is recurring issue?** N

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- **Backend:** FastAPI, Pydantic, CRUD assíncrono, manipulação de datas com , scripts de seeding de dados.
- **Frontend:** React (, , ), gerenciamento de estado complexo, renderização condicional, componentes de UI customizados para calendário, formulários.
- **Arquitetura:** Separação de lógica de cálculo (backend), componentes reutilizáveis, comunicação via API REST.

**key DB schema**
- **grades:** Adicionados campos  e .
- **calendar_events (nova):** 
- **attendance (nova):** 

**changes in tech stack**
- None.

**All files of reference**
- **Modificados/Reescritos:**
    - : Adicionados modelos  e . Modelo  atualizado.
    - : Adicionados endpoints para Calendário e Frequência.
    - : Lógica de cálculo de média e recuperação atualizada.
    - : Finalizada a implementação com duas recuperações e cálculo de média a partir da primeira nota.
    - : Adicionadas funções para os endpoints de Calendário e Frequência.
    - : Adicionadas rotas para Calendário, Eventos e Frequência.
    - : Adicionados links para as novas funcionalidades.
- **Criados:**
    - : Página principal do Calendário Letivo.
    - : Página para gerenciamento de eventos do calendário.
    - : Página para o novo módulo de Controle de Frequência.

**Areas that need refactoring**:
- O arquivo  continua muito grande e complexo.
- O arquivo  cresceu bastante e poderia ser dividido em componentes menores (ex: , , ).

**key api endpoints**
- : CRUD para eventos do calendário.
- : Resumo de eventos por ano.
- : Detalhes de um dia específico.
- : CRUD para registros de frequência.
- : Busca frequência por turma e data.
- : Busca frequência de um aluno.

**Critical Info for New Agent**
- O foco imediato é construir a funcionalidade de **Controle de Frequência (Fase 5)**, seguindo os requisitos detalhados fornecidos pelo usuário.
- Preste atenção às regras de negócio complexas: a frequência varia (diária vs. por matéria) dependendo do nível de ensino da turma.
- A permissão para lançar frequências em datas futuras é restrita a  e .
- O cálculo de 75% de presença deve ser feito sobre o total de dias letivos do ano, que são definidos no Calendário Letivo.

**documents created in this job**
- None.

**Last 10 User Messages and any pending user messages**
1.  **user:**  -> **COMPLETED** (Botão adicionado).
2.  **user:**  -> **COMPLETED** (Rota corrigida).
3.  **user:**  -> **COMPLETED** (Lógica da semana corrigida para Domingo-Sábado).
4.  **user:**  -> **COMPLETED** (Etiquetas removidas das células).
5.  **user:**  -> **ACKNOWLEDGED** (Agente propôs a próxima fase).
6.  **user:** (Fornece requisitos detalhados para a Fase 5 - Controle de Frequência). -> **IN PROGRESS** (Agente iniciou a implementação).
7.  **user:**  -> **IN PROGRESS** (Requisitos para a Fase 5).
8.  **user:**  -> **IN PROGRESS** (Requisitos para a Fase 5).
9.  **user:**  -> **IN PROGRESS** (Requisitos para a Fase 5).
10. **(pending) user:** Nenhuma mensagem pendente. O agente está implementando a última solicitação de funcionalidade.

**Project Health Check:**
- **Broken:** None.
- **Mocked:** None.

**3rd Party Integrations**
- None.

**Testing status**
- **Testing agent used after significant changes:** YES (Usado extensivamente para validar a Fase de Notas e a nova funcionalidade de Calendário).
- **Troubleshoot agent used after agent stuck in loop:** NO.
- **Test files created:** Sim, os agentes de teste criaram scripts de teste durante as execuções, mas eles são temporários.
- **Known regressions:** None.

**Credentials to test flow:**
- **Admin:**
    - **Email:** 
    - **Senha:** 
- **SEMED (Somente Leitura):**
    - **Email:** 
    - **Senha:** 

**What agent forgot to execute**
- O agente seguiu todas as solicitações do usuário de forma eficaz e sequencial. Nenhuma tarefa solicitada foi esquecida.</analysis>
