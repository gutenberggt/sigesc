<analysis>**original_problem_statement:**
O usuário iniciou um projeto chamado **SIGESC (Sistema Integrado de Gestão Escolar)**. A solicitação inicial foi um desafio aberto para desenvolver o projeto juntos. O usuário forneceu uma especificação técnica e funcional extremamente detalhada, incluindo:

**PRODUCT REQUIREMENTS:**
- **Nome:** SIGESC — Sistema Integrado de Gestão Escolar
- **Escopo:** Multi-escola, multi-perfil.
- **Tecnologia (adaptada):** Frontend React, Backend FastAPI, Banco de Dados MongoDB.
- **Papéis e Permissões:** Administrador, Secretário, Diretor, Coordenador, Aluno, Pais/Responsáveis, SEMED (Secretaria de Educação).
- **Funcionalidades Essenciais:**
    - Gestão de usuários com papéis e vínculos escolares.
    - Controle de notas (4 bimestres, média ponderada, recuperação).
    - Geração de documentos (Boletim, Ficha Individual, Declarações, etc.).
    - Comunicação interna (avisos).
- **Modelo de Dados:** Estrutura de coleções detalhada para escolas, usuários, turmas, componentes curriculares, alunos, etc.
- **Cálculos Específicos:** Fórmula de média ponderada ().
- **Refatoração:** Disciplina foi renomeado para Componente Curricular e se tornou um cadastro global (não por escola).
- **UI/UX:**
    - Cadastro de escolas com múltiplas abas (Dados Gerais, Infraestrutura, etc.).
    - Níveis de ensino com sub-opções hierárquicas (ex: ao selecionar Educação Infantil, mostrar Berçário, Maternal, etc.).
    - Opções de Visualizar, Editar e Excluir para os cadastros.
    - Dashboard com contadores dinâmicos.

**User's preferred language**: Portuguese (Português)

**what currently exists?**
Um projeto full-stack (React/FastAPI/MongoDB) para o SIGESC.
- **Fase 1 (Fundação & Autenticação):** CONCLUÍDA. O sistema possui autenticação baseada em JWT, rotas protegidas e middleware de RBAC (Role-Based Access Control) no backend. O frontend tem fluxo de login, logout e rotas protegidas.
- **Fase 2 (Cadastros Base):** CONCLUÍDA. Foram implementados os CRUDs completos para Escolas, Usuários, Turmas e Componentes Curriculares (antigas Disciplinas). O dashboard exibe contagens dinâmicas desses registros.
- **Fase 3 (Gestão de Alunos):** INICIADA. As rotas de backend e a estrutura inicial do frontend para o cadastro de alunos foram criadas.

**Last working item**:
- **Last item agent was working:** O agente estava implementando duas melhorias solicitadas pelo usuário no formulário de cadastro de escolas ():
    1.  Adicionar uma nova aba Turmas para listar as turmas daquela escola.
    2.  Tornar os checkboxes de Níveis de Ensino hierárquicos, mostrando sub-opções quando um nível principal é selecionado.
- **Status:** BLOCKED
- **Agent Testing Done:** N
- **Which testing method agent to use?** Frontend testing agent (depois de resolver o bug) para verificar a página de escolas ou usar a ferramenta de screenshot para validar a renderização correta da página e a funcionalidade das abas e checkboxes.
- **User Testing Done:** Y (O usuário reportou o erro que bloqueou o progresso).

**All Pending/In progress Issue list**:
- **Issue 1: Crash na página de cadastro de escolas (P0 - HIGHEST PRIORITY)**
    - **Descrição:** A página  está quebrada, exibindo um erro no console do navegador: . Isso impede qualquer interação com o cadastro de escolas.
    - **Attempted fixes:** Nenhum. O agente diagnosticou o problema (chamada de função antes da sua declaração no ) mas ainda não aplicou a correção.
    - **Next debug checklist:**
        1.  Abrir o arquivo .
        2.  Localizar a definição da função , que é uma .
        3.  Mover a definição de  para *antes* do hook  que a utiliza. A ordem das declarações é crucial para funções atribuídas a constantes.
        4.  Após a correção, reiniciar o frontend e verificar se a página carrega sem erros.
    - **Why fix this issue and what will be achieved with the fix?** Corrigir este bug é crítico para desbloquear a funcionalidade de gestão de escolas, que é central para o sistema e para a continuação das Fases 2 e 3.
    - **Status:** IN PROGRESS
    - **Is recurring issue?** N
    - **Should Test frontend/backend/both after fix?** Frontend.
    - **Blocked on other issue:** None.

**In progress Task List**:
- **Task 1: Finalizar as melhorias no Cadastro de Escola (P0)**
    - **Where to resume:** Após corrigir o bug , é preciso validar se as funcionalidades implementadas estão funcionando como esperado.
    - **Checklist:**
        1. Verificar se a nova aba Turmas é exibida no formulário de escola.
        2. Garantir que a aba Turmas carrega e exibe a lista de turmas associadas à escola que está sendo editada/visualizada.
        3. Testar a lógica dos checkboxes hierárquicos na aba Dados do Ensino para garantir que as sub-opções aparecem e desaparecem corretamente e que os dados são salvos.
    - **What will be achieved with this?** Atenderá completamente à solicitação do usuário da mensagem 284, melhorando a usabilidade e a granularidade do cadastro de escolas.
    - **Status:** IN PROGRESS
    - **Should Test frontend/backend/both after fix?** Frontend.
    - **Blocked on something:** Bloqueado pelo **Issue 1**.

**Upcoming and Future Tasks**
- **Upcoming Tasks (P0):**
    - **FASE 3 - Gestão de Alunos:**
        - Implementar o formulário de CRUD completo para **Alunos**, incluindo dados pessoais, endereço, documentos, e vínculo com escola/turma.
        - Implementar o CRUD completo para **Responsáveis (Guardians)**, permitindo vincular até 2 por aluno.
        - Criar o sistema de **Matrículas (Enrollments)** para vincular alunos a turmas e componentes curriculares.
- **Future Tasks (P1/P2):**
    - **FASE 4 - Sistema de Notas:** Implementar a tela de lançamento de notas (B1-B4, Recuperação) e o cálculo automático de médias.
    - **FASE 5 - Controle de Frequência:** Criar o sistema para registrar faltas e calcular o percentual de presença.
    - **FASE 6 - Portais de Visualização:** Desenvolver dashboards e portais específicos para cada papel (Aluno, Responsável, Diretor, etc.).
    - **FASE 7 - Sistema de Comunicação:** Implementar o CRUD de Avisos com direcionamento por público.
    - **FASE 8 - Geração de Documentos:** Criar a funcionalidade para gerar PDFs de boletins, declarações, etc.

**Completed work in this session**
- **Fase 1: Fundação & Autenticação (DONE)**
  - Implementação completa de autenticação JWT e RBAC no backend (, ).
  - Criação de fluxo de login, rotas protegidas e contexto de autenticação no frontend (, ).
- **Fase 2: Cadastros Base (DONE)**
  - CRUD completo para **Escolas** com formulário complexo em abas ().
  - CRUD para **Usuários**, **Turmas** e **Componentes Curriculares** (, , ).
  - Funcionalidades de **Visualizar**, **Editar** e **Excluir** nos cadastros.
  - Dashboard com contadores dinâmicos ().
  - Refatoração de Disciplinas para Componentes Curriculares como um módulo global.

**Earlier issues found/mentioned but not fixed**
- Nenhum. Todas as questões levantadas pelo usuário foram abordadas pelo agente, embora a última implementação tenha introduzido um novo bug.

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- **Backend:** FastAPI, MongoDB (com  para operações assíncronas), Pydantic.
- **Frontend:** React, React Router, Tailwind CSS, Radix UI (via shadcn/ui).
- **Authentication:** JWT (Access and Refresh Tokens).
- **Authorization:** Middleware de RBAC (Role-Based Access Control) no backend.

**key DB schema**
- : {id, name, inep_code, address, contacts, status, infrastructure_details, teaching_levels, etc.}
- : {id, full_name, email, password_hash, role, school_links[]}
- : {id, school_id, academic_year, name, grade_level, teacher_ids[]}
- : {id, name, code, workload, teaching_level, program} (Global, sem )
- : {id, user_id, school_id, enrollment_number, class_id}
- : {id, user_id, student_ids[]}
- : {id, student_id, class_id, course_id, academic_year}

**changes in tech stack**
- O usuário sugeriu usar Firebase, mas foi acordado manter a stack existente de **FastAPI + MongoDB + React**.

**All files of reference**
- : Arquivo principal do backend, contém todas as rotas da API.
- : Define a estrutura de todos os dados do banco de dados.
- : Página do frontend para o cadastro complexo de escolas. **Atualmente com erro.**
- : Centraliza todas as chamadas de API do frontend para o backend.
- : Painel principal após o login, com links para os módulos.
- : Configura todas as rotas do frontend.

**Critical Info for New Agent**
- O projeto é uma aplicação de gestão escolar (SIGESC) com requisitos detalhados fornecidos pelo usuário.
- O desenvolvimento está sendo feito em fases. As Fases 1 e 2 estão concluídas e a Fase 3 foi iniciada.
- O usuário é engajado e fornece feedback técnico preciso. As respostas devem ser em português.
- A tarefa imediata é corrigir o bug de inicialização na página  para desbloquear o desenvolvimento. Após a correção, a validação das novas funcionalidades (aba Turmas e checkboxes hierárquicos) é necessária.
- A stack técnica é FastAPI, MongoDB e React. Ignore a menção inicial do usuário sobre Firebase.

**documents created in this job**
- None

**Last 10 User Messages and any pending user messages**
1.  **User (msg 284):** Pediu para adicionar uma aba Turmas no cadastro de escolas e sub-opções para os Níveis de Ensino. (IN PROGRESS)
2.  **User (msg 313):** Reportou o erro fatal  na página de escolas. (PENDING FIX)

**Project Health Check:**
- **Broken:**
    - : Não renderiza devido a um erro de JavaScript (), bloqueando toda a gestão de escolas.

**3rd Party Integrations**
- None so far.

**Testing status**
- **Testing agent used after significant changes:** NO
- **Troubleshoot agent used after agent stuck in loop:** NO
- **Test files created:** None
- **Known regressions:** A página de gestão de escolas, que funcionava, agora está quebrada após a última implementação.

**Credentials to test flow:**
- **Usuário Admin:**
    - **Email:** 
    - **Senha:**  (conforme criado nos testes  do agente)</analysis>
