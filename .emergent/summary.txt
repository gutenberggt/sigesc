<analysis>**original_problem_statement:**
O usuário iniciou a tarefa com o objetivo de criar a funcionalidade de geração da Ficha Individual do Aluno em PDF. Durante o desenvolvimento, o usuário expandiu o escopo com uma série de solicitações de melhoria e novas funcionalidades:
1.  **[CONCLUÍDO]** Implementar a geração da Ficha Individual do Aluno em PDF, com base em um modelo fornecido, e integrá-la aos modais de impressão individual e em lote.
2.  **[CONCLUÍDO]** Realizar múltiplos ajustes de layout em todos os documentos PDF (Boletim, Ficha Individual, Declarações), incluindo a adição de um logotipo, alteração de frases, ajuste de largura de colunas, correção de dimensões de imagem e ajuste de espaçamento para evitar sobreposição de texto.
3.  **[CONCLUÍDO]** Corrigir um bug crítico no formulário de escolas, onde os campos Tipo de Unidade (Sede/Anexa) e Anexa a: não estavam sendo salvos no banco de dados.
4.  **[CONCLUÍDO]** Criar uma nova página de gerenciamento para a Unidade Mantenedora, uma entidade única que mantém as escolas. A página permite editar dados de identificação, endereço, contato e responsável legal.
5.  **[CONCLUÍDO]** Adicionar a funcionalidade de upload de logotipo para a Unidade Mantenedora, utilizando o sistema de armazenamento FTP existente.
6.  **[CONCLUÍDO]** Adicionar campos para Nome do Contato e Cargo na página da Unidade Mantenedora.
7.  **[EM ANDAMENTO]** Centralizar o uso dos dados da Unidade Mantenedora em todo o sistema. Isso inclui usar o logotipo e nome da mantenedora no cabeçalho principal da aplicação e em todos os documentos PDF, e usar a cidade e o estado da mantenedora como valores padrão (editáveis) nos formulários de cadastro.

**User's preferred language**: Portuguese (Português)

**what currently exists?**
Um sistema de gestão escolar (SIGESC) full-stack (React/FastAPI/MongoDB) que agora centraliza informações importantes na nova entidade Unidade Mantenedora. Os dados desta entidade (logotipo, nome, cidade, estado) são gerenciados em uma nova página de administração () e são usados dinamicamente em todo o sistema, incluindo o cabeçalho principal da aplicação e todos os documentos PDF gerados. A funcionalidade de Ficha Individual do Aluno foi implementada e está funcional. Um bug crítico no formulário de cadastro de escolas foi corrigido.

**Last working item**:
- **Last item agent was working:** O agente estava finalizando a tarefa de centralização dos dados da Unidade Mantenedora. Especificamente, estava atualizando todas as funções de geração de PDF () para que o nome e o município da mantenedora fossem inseridos dinamicamente nos cabeçalhos e rodapés dos documentos, substituindo textos estáticos.
- **Status:** IN PROGRESS
- **Agent Testing Done:** N (As modificações nos arquivos Python foram concluídas, mas o teste para verificar o resultado nos PDFs gerados ainda não foi executado.)
- **Which testing method agent to use?** backend testing agent (Para invocar os endpoints de geração de cada um dos 4 tipos de documento e validar que os dados da mantenedora aparecem corretamente).
- **User Testing Done:** N

**All Pending/In progress Issue list**:
- **Issue 1: As lotações de servidores parecem estar associadas a IDs de escolas que não existem mais (P2)**
    - **Description:** Durante o teste da aba Quadro de Servidores em um job anterior, foi notado que as lotações existentes no banco de dados referiam-se a escolas antigas. Isso sugere que pode haver dados órfãos no banco que precisam de limpeza.
    - **Status:** NOT STARTED
    - **Should Test frontend/backend/both after fix?** backend

**In progress Task List**:
- **Task 1: Validar a centralização de dados da Mantenedora nos PDFs (P0)**
    - **Where to resume:** O agente acabou de modificar o arquivo  para buscar os dados da mantenedora e passá-los para as funções de geração de PDF em . O próximo passo é executar testes (usando  ou o agente de testes) nos endpoints de documentos (, , etc.) para confirmar que o nome e a cidade da mantenedora estão sendo corretamente impressos nos PDFs.
    - **What will be achieved with this?** Garantir que todos os documentos gerados pelo sistema sejam padronizados e utilizem as informações oficiais da Unidade Mantenedora, eliminando dados estáticos e inconsistências.
    - **Status:** IN PROGRESS
    - **Should Test frontend/backend/both after fix?** backend
    - **Blocked on something:** N/A

**Upcoming and Future Tasks**
- **Upcoming Tasks:**
    - **P1: Implementar a lógica do Certificado do aluno:** A função  em  e seu endpoint existem, mas a lógica para gerar o conteúdo do certificado ainda é um placeholder.
- **Future Tasks:**
    - **P2: Refatorar **: O arquivo é grande e complexo, devendo ser dividido em componentes menores.
    - **P3: Refatorar **: Precisa ser dividido para melhor manutenibilidade.
    - **P4: Refatorar **: Também está crescendo em complexidade e seria um bom candidato para refatoração.

**Completed work in this session**
- **Implementação da Ficha Individual do Aluno**: Criada a lógica de backend em  e a integração no frontend para gerar o documento completo, incluindo a tabela de notas.
- **Criação da página Unidade Mantenedora**: Implementado um CRUD completo (modelo, API e página React) para gerenciar os dados da instituição mantenedora, incluindo upload de logotipo.
- **Correção do Bug de Cadastro de Escolas**: Resolvido o problema que impedia o salvamento dos campos  e . A causa era uma inconsistência de nomenclatura entre o frontend () e o backend ().
- **Centralização de Dados da Mantenedora**:
    - O cabeçalho principal da aplicação () agora exibe dinamicamente o logotipo e o nome da mantenedora.
    - O formulário de novas escolas () pré-preenche os campos de município e estado com base nos dados da mantenedora.
    - Criado um  para disponibilizar os dados globalmente no frontend.
- **Ajustes de Layout nos PDFs**: Realizadas diversas iterações de ajustes visuais nos documentos PDF (logo, slogan, espaçamento, largura de colunas) conforme solicitações do usuário.
- **Melhorias na UI**: Adicionado um atalho Início na página da Mantenedora e reorganizado o cabeçalho principal para incluir informações da mantenedora.

**Earlier issues found/mentioned but not fixed**
- **Issue 1: Dados órfãos de lotação de servidores:** Lotações de servidores podem estar vinculadas a IDs de escolas que não existem mais. Status: NOT STARTED.
- **Issue 2: Refatoração de componentes grandes:**  e  foram mencionados na handover inicial como necessitando de refatoração. Status: NOT STARTED.

**Known issue recurrence from previous fork**
- None.

**Code Architecture**


**Key Technical Concepts**
- **Global State Management (React Context):** Foi introduzido um  para fornecer os dados da instituição mantenedora a múltiplos componentes (Layout, SchoolsComplete) de forma eficiente, sem .
- **Single Source of Truth:** A aplicação foi refatorada para usar a entidade Unidade Mantenedora como a fonte única de verdade para informações como logotipo, nome oficial, cidade e estado, garantindo consistência em toda a UI e nos documentos gerados.
- **Dynamic PDF Generation:** A geração de PDFs com  foi aprimorada para buscar e incorporar dinamicamente dados de uma nova coleção do banco de dados (a ) em tempo de execução.

**key DB schema**
- **schools:** Os campos  (string: 'sede' ou 'anexa') e  (string, ID da escola sede) foram adicionados aos modelos Pydantic e estão sendo salvos corretamente.
- **mantenedora:** (NOVA COLEÇÃO) Uma coleção que armazena um único documento com os dados da instituição mantenedora. Campos incluem , , , , , , , etc.

**changes in tech stack**
- Nenhuma.

**All files of reference**
- **/app/frontend/src/pages/Mantenedora.js**: (NOVO) Página React para gerenciar os dados da Unidade Mantenedora.
- **/app/frontend/src/contexts/MantenedoraContext.js**: (NOVO) Contexto React para compartilhar os dados da mantenedora globalmente.
- **/app/backend/models.py**: (MODIFICADO) Adicionado o modelo  e corrigido os modelos  e .
- **/app/backend/server.py**: (MODIFICADO) Adicionados os endpoints  e . Os endpoints de documentos foram atualizados para passar os dados da mantenedora.
- **/app/backend/pdf_generator.py**: (MODIFICADO) Implementada a  e atualizados todos os documentos para usar dados dinâmicos da mantenedora.
- **/app/frontend/src/components/Layout.js**: (MODIFICADO) O cabeçalho superior foi atualizado para exibir o logotipo e o nome da mantenedora.
- **/app/frontend/src/pages/SchoolsComplete.js**: (MODIFICADO) Corrigido o bug de salvamento e implementado o preenchimento automático de cidade/estado.

**Areas that need refactoring**:
- 
- 
- 

**key api endpoints**
- **GET **: (NOVO) Retorna o documento único da Unidade Mantenedora.
- **PUT **: (NOVO) Atualiza o documento da Unidade Mantenedora.
- **GET **: (MODIFICADO) Agora usa dados da mantenedora.
- **GET **: (MODIFICADO) Agora usa dados da mantenedora.
- **GET **: (MODIFICADO) Agora usa dados da mantenedora.
- **GET **: (MODIFICADO) Agora usa dados da mantenedora.

**Critical Info for New Agent**
- **Unidade Mantenedora é a Fonte da Verdade:** A lógica do sistema agora depende da entidade Unidade Mantenedora. Seus dados (logo, nome, cidade, estado) são usados no cabeçalho global, nos padrões de formulários e em todos os PDFs. A página de gerenciamento é .
- **Contexto Global no Frontend:** Os dados da mantenedora são carregados no  em . Componentes que precisam desses dados devem usar o hook .
- **Bug da Escola Corrigido:** O problema onde  e  não salvavam foi resolvido. A correção envolveu alinhar o nome do campo no estado do formulário do frontend ( -> ) para corresponder ao modelo do backend.

**documents and test_reports created in this job**
- None.

**Last 10 User Messages and any pending HUMAN messages**
1.  **user:** Pede para substituir Município pelo município da mantenedora e usar o nome da mantenedora em vez de textos estáticos nos PDFs.
2.  **user:** Pede para inverter a ordem do logo SIGESC e da mantenedora no cabeçalho principal.
3.  **user:** Pede para adicionar o brasão e o nome da mantenedora no cabeçalho principal, ao lado do logo SIGESC.
4.  **user:** Pede para adicionar um atalho Início na página da Mantenedora.
5.  **user:** Solicita que o logotipo, cidade e estado da mantenedora sejam usados como padrão em todo o projeto (PDFs, formulários).
6.  **user:** Pede para dividir a linha do formulário para ter Nome do Contato e Cargo lado a lado.
7.  **user:** Pede para adicionar o nome da pessoa de contato no card de contato da Mantenedora.
8.  **user:** Pede para confirmar e/ou alterar o caminho de salvamento do logotipo da mantenedora para .
9.  **user:** Pede para adicionar o campo de Logotipo na página da Mantenedora.
10. **user:** Solicita a criação da página da Unidade Mantenedora, informando que haverá apenas uma.

**Project Health Check:**
- **Broken:** None
- **Mocked:** None

**3rd Party Integrations**
- **reportlab**: Usado no backend para geração de PDFs.
- **Servidor FTP Externo ()**: Usado para armazenamento persistente de todos os arquivos enviados pelos usuários (fotos de perfil, capas, documentos, logotipos).

**Testing status**
- **Testing agent used after significant changes:** YES (para a validação da Ficha Individual).
- **Troubleshoot agent used after agent stuck in loop:** NO
- **Test files created:** None.
- **Known regressions:** None.

**Credentials to test flow:**
- **Admin:**  / 
- **Professor:**  / 

**What agent forgot to execute**
O agente seguiu todas as solicitações do usuário na sessão atual. As tarefas pendentes (refatoração, limpeza de dados de lotação) foram herdadas do job anterior e ainda não foram priorizadas.</analysis>
