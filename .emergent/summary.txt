<analysis>**original_problem_statement:**
O usuário solicitou uma série de funcionalidades, correções e uma nova página para o papel de Assistente Social.

Requisitos implementados nesta sessão:
1.  **Implementar Papel Ass. Social:** Criar um novo papel de usuário Ass. Social, que só pode ser atribuído por um administrador.
2.  **Dashboard para Assistente Social:** Desenvolver uma página exclusiva para este papel que permita a busca de alunos por nome ou CPF e exiba detalhes específicos, incluindo um cálculo de frequência personalizado.
3.  **Cálculo de Frequência:** Implementar a fórmula  para exibir a porcentagem de frequência no novo dashboard.
4.  **Atalho no Menu:** Adicionar um link para o novo dashboard no menu de administração.
5.  **Verificação de Bugs:** Executar uma varredura geral no sistema para identificar inconsistências.
6.  **Correção de Bug de Papel:** Corrigir um erro no backend onde o novo papel ass_social não era reconhecido, impedindo a criação de usuários.
7.  **Conclusão do Módulo AEE:** Verificar o estado do módulo Diário AEE e finalizá-lo.
8.  **Consulta de Infraestrutura:** Responder a perguntas sobre as configurações ideais de servidor (DigitalOcean, Coolify) para a aplicação em produção.

**User's preferred language**: Portuguese (Português)

**what currently exists?**
A aplicação full-stack (React + FastAPI + MongoDB) está funcional. Nesta sessão, foram implementados com sucesso o novo papel de usuário Ass. Social e seu respectivo dashboard.

- **Dashboard Ass. Social:** Uma nova página () foi criada. Ela contém uma busca por aluno (nome/CPF) que, ao selecionar um resultado, exibe um card com informações detalhadas: dados do aluno, escola e um cálculo de frequência preciso.
- **Cálculo de Frequência:** Um novo endpoint () foi criado no backend para calcular a frequência com base nos dias letivos do calendário e nas faltas registradas, conforme a fórmula solicitada pelo usuário. O frontend foi atualizado para usar este endpoint e exibir os resultados.
- **Controle de Acesso:** A criação do papel Ass. Social foi restringida para ser visível e atribuível apenas por administradores, e um atalho para o novo dashboard foi adicionado ao menu de administração.
- **Correções de Bugs:** Foi resolvido um erro de validação no backend que impedia a criação de usuários com o novo papel. Adicionalmente, durante a verificação do sistema, foi identificado e corrigido um bug que causava erro na busca de turmas devido a valores em caixa alta () no campo  no banco de dados.
- **Verificação do Diário AEE:** O agente analisou o código e testou a funcionalidade do Diário AEE, concluindo que o módulo já está completo e funcional, com todas as abas, modais e funcionalidades de geração de PDF implementadas.

**Last working item**:
-   **Last item agent was working:** O usuário solicitou a conclusão do módulo Diário AEE. O agente investigou o estado atual do módulo, analisando os arquivos  e , e concluiu que a funcionalidade já estava completa. O agente apresentou capturas de tela mostrando o módulo em funcionamento para o usuário.
-   **Status:** USER VERIFICATION PENDING
-   **Agent Testing Done:** Y (Manual verification with screenshots)
-   **Which testing method agent to use?** manual testing by user. O usuário precisa confirmar se o estado atual do módulo Diário AEE atende às suas expectativas.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: (P0) Processo de Deploy em Produção Quebrado (Gateway Timeout).**
-   **Issue 2: (P1) Migração para CAIXA ALTA pode estar incompleta.**
-   **Issue 3: (P2) Falta de feedback em tempo real para CPF duplicado no frontend.**

**Issues Detail:**
-   **Issue 1: Processo de Deploy em Produção Quebrado (Gateway Timeout).**
    -   **Attempted fixes:** Nenhuma nesta sessão. O agente forneceu consultoria sobre infraestrutura, mas não atuou no problema de deploy.
    -   **Next debug checklist:**
        1.  Solicitar ao usuário acesso aos logs do Coolify durante uma tentativa de deploy.
        2.  Verificar os recursos (CPU/Memória) do Droplet no momento do build.
        3.  Analisar o  e os scripts de build em busca de processos demorados ou com alto consumo de memória.
        4.  Sugerir aumentar o timeout de build no Coolify, se possível.
    -   **Why fix this issue and what will be achieved with the fix?** Este é o bloqueador mais crítico. Corrigi-lo permitirá que o usuário veja todas as novas funcionalidades e correções em produção, eliminando a principal fonte de frustração e relatórios de bugs repetidos.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** backend
    -   **Blocked on other issue:** Não. Este é o bloqueador principal.

-   **Issue 2: Migração para CAIXA ALTA pode estar incompleta.**
    -   **Attempted fixes:** Na sessão anterior, um script foi executado. O usuário relatou que alguns dados permaneceram em minúsculas.
    -   **Next debug checklist:**
        1.  Instruir o usuário a fazer uma limpeza de cache forçada no navegador (Ctrl+F5).
        2.  Re-executar o script de migração ou um script aprimorado, se a limpeza de cache não resolver.
        3.  Verificar se os dados em minúsculas vêm de uma coleção ou campo não coberto pelo script original.
    -   **Why fix this issue and what will be achieved with the fix?** Garantirá a consistência visual dos dados em toda a aplicação.
    -   **Status:** USER VERIFICATION PENDING
    -   **Is recurring issue?** Y
    -   **Should Test frontend/backend/both after fix?** frontend

-   **Issue 3: Falta de feedback em tempo real para CPF duplicado no frontend.**
    -   **Attempted fixes:** N/A.
    -   **Next debug checklist:**
        1.  No formulário de criação/edição de aluno, implementar um  ou  no campo de CPF.
        2.  Criar uma função que chama um endpoint no backend para verificar se o CPF já existe.
        3.  Exibir uma mensagem de erro abaixo do campo de CPF se o backend retornar que ele já está em uso.
    -   **Why fix this issue and what will be achieved with the fix?** Melhorará a experiência do usuário, evitando que ele preencha um formulário inteiro para só então descobrir que o CPF é duplicado.
    -   **Status:** NOT STARTED
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** frontend

**In progress Task List**:
Nenhuma.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   (P1) Implementar aviso em tempo real para CPF duplicado (ver Issue 3).
-   **Future Tasks:**
    -   (P2) Refatorar o componente  para melhor manutenibilidade.
    -   (P2) Implementar envio de e-mail de confirmação na pré-matrícula.
    -   (P2) Continuar a refatoração do backend, extraindo mais rotas do  para arquivos dedicados.

**Completed work in this session**
-   **Implementação do Papel Ass. Social:** Adicionado novo papel e restrição de acesso.
-   **Dashboard para Assistente Social:** Criada a página  com busca de alunos e exibição de detalhes.
-   **Correção do Cálculo de Frequência:** Criado endpoint e lógica no frontend para calcular a frequência com base nos dias letivos.
-   **Atalho no Menu de Admin:** Adicionado botão para o novo dashboard.
-   **Correção do Bug de Validação de Papel:** Atualizados os modelos Pydantic no backend para aceitar o .
-   **Investigação do Bug de Edição de Escolas:** Confirmado que a funcionalidade está operante e o problema anterior era um erro no teste.
-   **Verificação e Confirmação do Módulo Diário AEE:** Analisado e validado que o módulo já está completo e funcional.
-   **Consultoria de Infraestrutura:** Fornecidas recomendações detalhadas sobre DigitalOcean, Coolify e DNS.

**Code Architecture**


**Key Technical Concepts**
-   **Criação de Endpoint Específico:** Desenvolvimento de uma nova rota em FastAPI () para realizar um cálculo complexo que envolve múltiplas fontes de dados (faltas do aluno e calendário de dias letivos).
-   **Atualização de Enum Pydantic:** Correção de um erro de validação () ao adicionar o novo valor  ao   no arquivo , sincronizando o frontend com o backend.
-   **Lógica de Redirecionamento no Frontend:** Uso do  e  no componente  para redirecionar automaticamente usuários com o papel  para sua página específica após o login.
-   **Depuração de Inconsistência de Dados:** Identificação de um erro 500 causado pela migração para caixa alta, que converteu o valor  para  no campo  da coleção , violando a validação do modelo Pydantic. A correção foi feita diretamente no banco de dados.

**key DB schema**
-   Nenhuma alteração de schema, apenas uma modificação no Enum de papéis de usuário.
-   **User:** 

**All files of reference**
-   : (NOVO) Página principal da nova funcionalidade.
-   : (MODIFICADO) Contém o novo endpoint de cálculo de frequência.
-   : (MODIFICADO) Onde o novo papel  foi adicionado ao .
-   : (MODIFICADO) Onde a nova rota e a lógica de redirecionamento foram configuradas.
-   : (MODIFICADO) Contém o novo atalho no menu.
-   : Arquivo analisado para verificar a conclusão da tarefa.

**Critical Info for New Agent**
-   **A prioridade máxima é o problema de deploy (Gateway Timeout).** Nenhuma das melhorias desta sessão será visível para o usuário até que isso seja resolvido. Prepare-se para depurar o processo de build no Coolify.
-   O usuário pediu para concluir o Diário AEE. Antes de iniciar qualquer desenvolvimento, confirme com o usuário que você revisou o módulo e ele parece completo, mostrando as capturas de tela novamente se necessário. É provável que ele não tenha visto o estado final devido ao problema de deploy.
-   Esteja ciente das questões de consistência de dados (maiúsculas/minúsculas), pois um problema semelhante (campo  das turmas) causou erros 500 e pode haver outros casos.

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Pediu uma verificação de bugs no sistema. (Status: **DONE**)
2.  **User:** Continue! - Aprovando a execução do agente de testes. (Status: **DONE**)
3.  **User:** Pediu para corrigir a fórmula de cálculo da frequência no dashboard do Assistente Social. (Status: **DONE**)
4.  **User:** Pediu para remover a exibição da fórmula da tela, mantendo apenas o resultado. (Status: **DONE**)
5.  **User:** Perguntou sobre requisitos de infraestrutura (DigitalOcean/Coolify) para 22 escolas. (Status: **ANSWERED**)
6.  **User:** Perguntou se o nome de domínio interfere no desempenho. (Status: **ANSWERED**)
7.  **User:** Afirmou não saber se usa Cloudflare. (O agente investigou e confirmou que sim). (Status: **DONE**)
8.  **User:** Reportou um erro de validação do backend () ao tentar criar um usuário com o novo papel. (Status: **FIXED**)
9.  **User:** Continue - Aprovando a correção do bug. (Status: **DONE**)
10. **User:** Pediu para concluir o módulo Diário AEE. (Status: **PENDING USER VERIFICATION** - O agente já verificou que o módulo está completo).

**Project Health Check:**
-   **Broken:**
    -   O processo de deploy para o ambiente de produção do usuário via Coolify está quebrado, resultando em Gateway Timeout. Este é um bloqueador crítico que impede a entrega de valor.

**3rd Party Integrations**
-   Nenhuma nova integração foi adicionada.

**Testing status**
-   **Testing agent used after significant changes:** YES. Foi usado para testar o novo dashboard Assistente Social e para uma verificação geral do sistema.
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** []
-   **Known regressions:** Nenhuma.

**Credentials to test flow:**
-   **Administrador:**  / </analysis>
