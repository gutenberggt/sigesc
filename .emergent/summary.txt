<analysis>**original_problem_statement:**
O usuário iniciou a sessão para implementar a funcionalidade Converter em Aluno e, em seguida, solicitou uma série de novas funcionalidades e melhorias, incluindo:
1.  Adicionar um link direto para o perfil do aluno recém-criado.
2.  Alterar o formulário de pré-matrícula para exibir um dropdown dinâmico de Série/Ano com base na escola selecionada.
3.  Adicionar um campo Tipo de Atendimento/Programa (Integral, AEE, etc.) no cadastro de turmas, com opções baseadas na escola.
4.  Substituir a coluna Código INEP pela contagem de alunos na lista de escolas.
5.  Gerar uma documentação simplificada do projeto.
6.  Por fim, o usuário relatou um problema crítico no deploy da aplicação na plataforma Coolify e pediu ajuda para depurá-lo.

**User's preferred language**: Portuguese (Português)

**what currently exists?**
O sistema é uma aplicação full-stack (React + FastAPI + MongoDB) com funcionalidades extensivas de gestão escolar, incluindo PWA/offline. Nesta sessão, foram implementadas com sucesso as seguintes funcionalidades:
- **Conversão de Pré-Matrícula:** Um fluxo completo para aprovar uma pré-matrícula e convertê-la em um novo registro de aluno, incluindo um link de navegação direto para o perfil do aluno recém-criado.
- **Formulário de Pré-matrícula Dinâmico:** O formulário público agora exibe um dropdown de Série/Ano que mostra apenas as séries que a escola selecionada oferece.
- **Tipos de Turma:** O formulário de turmas agora permite especificar se uma turma faz parte de um programa especial (Integral, AEE), com opções dinâmicas baseadas na configuração da escola.
- **Contagem de Alunos:** A lista de escolas agora exibe a contagem de alunos ativos em vez do código INEP.
- **Configuração de Deploy:** Foram criados todos os arquivos necessários (, , etc.) para realizar o deploy da aplicação via Coolify.

**Last working item**:
-   **Last item agent was working:** O agente estava diagnosticando e resolvendo um erro de deploy na plataforma Coolify do usuário. A aplicação não estava funcionando porque o serviço de backend estava em um loop de reinicialização com status unhealthy.
-   **Status:** USER VERIFICATION PENDING
-   **Agent Testing Done:** N
-   **Which testing method agent to use?** N/A. O problema reside no ambiente de deploy externo do usuário (Coolify). O próximo agente deve primeiro confirmar com o usuário se a solução proposta funcionou, solicitando os logs do backend se o problema persistir.
-   **User Testing Done:** N

**All Pending/In progress Issue list**:
-   **Issue 1: (P0) Falha no Deploy em Produção (Coolify)**
    -   **Description:** O serviço de backend está  no ambiente Coolify do usuário, impedindo o funcionamento da aplicação.
    -   **Attempted fixes:** O agente analisou os logs do backend fornecidos pelo usuário e identificou a causa raiz: o serviço  está parado, resultando em um erro de  quando o backend tenta se conectar.
    -   **Next debug checklist:**
        1.  Perguntar ao usuário se ele conseguiu seguir as instruções para reiniciar os serviços no Coolify (primeiro o , depois o ).
        2.  Se o problema persistir, pedir ao usuário para compartilhar os logs mais recentes do serviço  e do  para reavaliar o estado.
        3.  Guiar o usuário novamente, se necessário, sobre como executar os comandos de reinicialização via terminal () ou através do painel do Coolify.
    -   **Why fix this issue and what will be achieved with the fix?** Este é um bloqueador crítico. A aplicação está inacessível no ambiente de produção do usuário. A resolução permitirá que a aplicação volte a funcionar.
    -   **Status:** USER VERIFICATION PENDING
    -   **Is recurring issue?** N
    -   **Should Test frontend/backend/both after fix?** Backend (verificar logs e o endpoint de health).
    -   **Blocked on other issue:** Não.

**In progress Task List**:
-   Nenhum.

**Upcoming and Future Tasks**
-   **Upcoming Tasks:**
    -   **(P1) Melhoria Pré-Matrícula:** Enviar um email de confirmação para o responsável após a pré-matrícula ser enviada com sucesso.
    -   **(P1) Melhoria na Lista de Alunos:** Implementar a lógica na página  para usar o parâmetro de URL  e destacar o aluno recém-criado na lista.
-   **Future Tasks:**
    -   **(P2) Refatoração do Backend:** Continuar movendo endpoints do  para routers modulares.
    -   **(P2) Refatoração do Frontend:** Simplificar o componente  e o .
    -   **(P3) Limpeza de Código:** Remover o arquivo obsoleto .

**Completed work in this session**
-   **Feature: Converter Pré-Matrícula em Aluno:** Implementado o endpoint  e a interface no frontend () para converter uma pré-matrícula aprovada em um aluno.
-   **UX Improvement: Link para Aluno Recém-Criado:** Adicionado um botão Ver Aluno nos cards de pré-matrículas convertidas, que navega para a página de alunos com um parâmetro  na URL.
-   **Feature: Seleção Dinâmica de Série/Ano:** O formulário de pré-matrícula () foi atualizado para mostrar apenas as séries/anos disponíveis na escola selecionada.
-   **Feature: Distinção de Turmas por Programa:** O formulário de turmas () agora inclui um campo Tipo de Atendimento, cujas opções dependem das configurações da escola selecionada.
-   **Feature: Contagem de Alunos na Lista de Escolas:** A coluna Código INEP foi substituída pela contagem de alunos ativos nas páginas  e , com o backend  agora fornecendo esse dado.
-   **Documentation:** Gerada uma descrição detalhada de todas as páginas e endpoints do sistema.
-   **Deployment Setup:** Criados s, , e arquivos de configuração Nginx para facilitar o deploy no Coolify.

**Earlier issues found/mentioned but not fixed**
-   Nenhum.

**Known issue recurrence from previous fork**
-   Nenhum.

**Code Architecture**


**Key Technical Concepts**
-   **Docker & Coolify Deployment:** O agente introduziu uma configuração completa de containerização com  para frontend (React+Nginx) e backend (FastAPI), orquestrada com . O foco principal foi a depuração de problemas em um ambiente PaaS (Coolify), analisando logs de serviços para diagnosticar falhas de conexão () e configuração de roteamento (Traefik).
-   **API com Agregação de Dados:** O endpoint  foi modificado para agregar dados de outra coleção (contagem de alunos), simplificando a lógica no frontend.
-   **Lógica Dinâmica no Frontend:** Vários componentes foram aprimorados para exibir opções dinamicamente com base em seleções do usuário (e.g., séries disponíveis por escola, programas disponíveis por escola).

**key DB schema**
-   **pre_matriculas:**  (campos adicionados)
-   **classes:**  (campo adicionado)
-   **schools:** (Resposta da API modificada para incluir )

**changes in tech stack**
-   Nenhuma mudança no stack de desenvolvimento. Adição de **Docker, Docker Compose e Nginx** para fins de deploy.

**All files of reference**
-   **Criados:**
    -   , , 
    -   , 
    -   
-   **Atualizados:**
    -   : Adicionado endpoint de conversão de pré-matrícula.
    -   : Atualizados modelos  e .
    -   : Adicionada contagem de alunos na listagem de escolas.
    -   : Implementação do fluxo de conversão.
    -   : Implementação do seletor dinâmico de série/ano.
    -   : Implementação do campo Tipo de Atendimento.
    -    e : Exibição da contagem de alunos.
    -   : Atualizado com as novas funcionalidades concluídas.

**Areas that need refactoring**:
-   **:** Ainda contém muitos endpoints que poderiam ser movidos para routers modulares.
-   **:** Continua sendo um componente grande e complexo.

**key api endpoints**
-   : (Novo) Converte uma pré-matrícula em um novo aluno.
-   : (Modificado) Agora retorna um campo  em cada objeto de escola.

**Critical Info for New Agent**
-   A prioridade máxima é confirmar com o usuário se a solução para o problema de deploy no Coolify funcionou. O problema foi identificado como o serviço MongoDB estar parado. As instruções para reiniciar os serviços foram fornecidas.
-   Não modifique os arquivos de Docker ou a configuração de deploy antes de confirmar se o simples reinício dos serviços resolveu o problema.
-   Depois que o problema de deploy for resolvido, apresente ao usuário o plano para as próximas tarefas, começando pelas Upcoming Tasks.

**documents and test reports created in this job**
-    (atualizado)

**Last 10 User Messages and any pending HUMAN messages**
10.  - O usuário expressou dificuldade em reiniciar o serviço MongoDB no Coolify.
9.   - O usuário confirmou o envio do log do backend.
8.   - O usuário enviou o arquivo de log do backend.
7.   - O usuário enviou screenshots da UI do Coolify mostrando o status dos serviços.
6.   - O usuário relatou que o problema de deploy persistia e compartilhou a configuração do roteador (Traefik/Caddy).
5.   - O usuário iniciou a depuração do deploy, compartilhando um log de erro do  no Docker.
4.   - Pedido de documentação do sistema.
3.   - Pedido de nova feature.
2.   - Pedido de nova feature.
1.   - Pedido de nova feature/clarificação.

**Project Health Check:**
-   **Broken:** O deploy externo do usuário na plataforma Coolify está quebrado. O serviço  está  porque o serviço  está desligado, causando falhas de conexão.
-   **Mocked:** Nenhum.

**3rd Party Integrations**
-   reportlab
-   PyPDF2
-   openpyxl
-   slowapi
-   dexie & dexie-react-hooks
-   Servidor FTP ()

**Testing status**
-   **Testing agent used after significant changes:** NO
-   **Troubleshoot agent used after agent stuck in loop:** NO
-   **Test files created:** None
-   **Known regressions:** None

**Credentials to test flow:**
-   **Admin:**  / 
-   **Coordenador/Professor:**  / 

**What agent forgot to execute**
-   Nada. O agente implementou todas as solicitações de feature do usuário e depois pivotou para uma complexa sessão de depuração de deploy, que está corretamente pausada aguardando a ação do usuário.</analysis>
